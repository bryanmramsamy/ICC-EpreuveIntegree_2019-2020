{% extends 'base.html' %}
{% load i18n registration_extra static %}

{% block title %}{% trans 'Degrees catalog' %}{% endblock title %}

{% block content %}

  {# Heading jumbotron #}

  <section class="jumbotron jumbotron-fluid" style="background-image: url('{% static 'images/graduation_02.jpg' %}'); background-attachment: fixed; background-size: 1100px;">
    <div class="container bg-light" style="font-family: papyrus; opacity: 0.9;">
      <div class="row row-cols-1 row-cols-md-2">
        <div class="col col-md-8">
          <h1 class="display-4" style="font-style: italic;">
            {% include 'logo/degree.html' %}
            {% trans 'Degrees catalog' %}
          </h1>
          <hr>
          <p class="lead">
            {% blocktrans %}
              A degree is like a stair: you start from the bottom, you must take each stair one by one at your own pace, underway you may find this tiring but if you keep going, you will end on the top.
            {% endblocktrans %}
          </p>
        </div>

        <div class="col col-md-4">
          <img src="{% static 'draws/graduation.svg' %}" alt="Degrees catalog" class="img-fluid rounded">
        </div>
      </div>
    </div>
  </section>


  {# Information bubble #}


  {# Statistical informations #}

  <section class="container">
    <div class="row text-muted">
      <div class="col-sm">
        {% blocktrans count nb_degrees=degrees.count %}
          There is actually only one degree available.
        {% plural %}
          They are actually {{ nb_degrees }} degrees available.
        {% endblocktrans %}
      </div>
    </div>
  </section>


  {# Create new module button #}

  <div class="row">
    {% if request.user|is_manager_or_administrator %}
      <div class="col">
        <a href="{% url 'degree_createview' %}" class="btn btn-block btn-warning">
          Create a new degree {% include 'logo/new.html' %}
        </a>
      </div>
    {% endif %}
    <div class="col">
      <a href="{% url 'degreecategory_listview' %}" class="btn btn-block btn-dark">
        Consult the degrees by category {% include 'logo/degree_alt.html' %}
      </a>
    </div>
  </div>


  {# Modules cards #}

  <section class="container">
    <div class="row row-cols-1">
      {% for degree in degrees %}
      <div class="card my-3">
        <div class="card-header text-center pt-3">
          <div class="row">
            <div class="col d-none d-md-block">
              XXX
            </div>
            <div class="col h5">
              {% trans 'Regitration fee: ' %}<strong>â‚¬ {{ degree.total_price }}</strong>
            </div>
            <div class="col d-none d-md-block">
              XXX
            </div>
          </div>
        </div>

        <div class="card-body">
          <div class="row">
            <div class="col-md-4 text-center">
              <img src="{{ degree.picture.url }}" class="img-fluid" alt="{{ degree.title }} degree picture" style="max-height: 200px;">
            </div>
              <div class="col-md-8">
                <div class="card-body">
                  <h5 class="card-title">{% include 'logo/degree.html' %} {{ degree.title }}</h5>
                  <p class="card-text"><small class="text-muted">{{ degree.reference }} | {% include 'logo/degree.html' %} {{ degree.category.name }}</small></p>
                  <p class="card-text">{{ degree.description|linebreaks|truncatechars:256 }}</p>
                  <div>
                    {% if request.user|is_student %}
                      {% if request.user|degree_already_validated_by_user:degree %}
                        <span class="text-success">
                          {% include 'logo/check_valid.html' %} {% trans 'Degree already validated' %}
                        </span>
                      {% else %}
                        <span class="text-danger">
                          {% include 'logo/check_invalid.html' %} {% trans 'Degree not validated' %}
                        </span>
                      {% endif %}
                    {% else %}
                      <span class="text-info">
                        {% include 'logo/check_info.html' %} 
                        {% blocktrans count nb_modules=degree.modules.all.count %}
                          This degree is composed of only one module.
                        {% plural %}
                          This degree is composed of {{ nb_modules }} modules.
                        {% endblocktrans %}
                      </span>
                    {% endif %}
                  </div>
                </div>
              </div>
            </div>
          </div>

          <div class="card-footer text-center">
            <div class="row row-cols-1 row-cols-md-2 my-2 my-md-0">
              <div class="col mb-2 mb-md-0">
                <a href="{{ degree.get_absolute_url }}" class="btn btn-block btn-outline-dark">{% trans 'See more' %} {% include 'logo/more.html' %}</a>
              </div>

              {% if request.user|is_manager_or_administrator %}
                <div class="col">
                  <div class="row">
                    <div class="col">
                      <a href="{% url 'degree_updateview' pk=degree.pk %}" class="btn btn-block btn-warning">{% trans 'Update' %} {% include 'logo/edit.html' %}</a>
                    </div>
                    <div class="col">
                      <a href="{% url 'degree_deleteview' pk=degree.pk %}" class="btn btn-block btn-danger">{% trans 'Delete' %} {% include 'logo/delete.html' %}</a>
                    </div>
                  </div>
                </div>

              {% elif request.user|is_teacher %}
                <div class="col">
                  <a href="404" class="btn btn-block btn-info">{% trans 'DEBUG: No functionality yet for Teachers' %} {% include 'logo/warning.html' %}</a>  <!-- TODO: add functionality -->
                </div>

              {% elif request.user|is_student %}
                <div class="col">
                  <a href="{% url 'module_payment' pk=degree.pk %}" class="btn btn-block btn-dark">{% trans 'Subscribe to this degree' %} {% include 'logo/puzzle.html' %}</a>  <!-- TODO: redirect to module_rr_createview -->
                </div>

              {% elif request.user|is_guest %}
                <div class="col">
                  <a href="{% url 'pursue_registration' %}" class="btn btn-block btn-dark">{% trans 'Finish your registration as a student' %} {% include 'logo/register_alt.html' %}</a>
                </div>

              {% else %}
                <div class="col">
                  <div class="row">
                    <div class="col">
                      <a href="{% url 'register' %}" class="btn btn-block btn-dark">{% trans 'Sign up' %} {% include 'logo/register.html' %}</a>
                    </div>
                    <div class="col">
                      <a href="{% url 'login' %}" class="btn btn-block btn-outline-dark">{% trans 'Sign in' %} {% include 'logo/in-left.html' %}</a>
                    </div>
                  </div>
                </div>
              {% endif %}
            </div>
          </div>
        </div>
      {% endfor %}
    </div>
  </section>

{% endblock content %}
