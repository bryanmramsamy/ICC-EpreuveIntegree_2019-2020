{% extends 'base.html' %}
{% load i18n registration_extra static %}

{% block title %}{% trans 'Modules catalog' %}{% endblock title %}

{% block content %}


  {# Heading jumbotron #}

  <section class="jumbotron jumbotron-fluid" style="background-image: url('{% static 'images/puzzle_01.jpg' %}'); background-attachment: fixed; background-size: 1200px;">
    <div class="container bg-light" style="font-family: papyrus; opacity: 0.9;">
      <div class="row row-cols-1 row-cols-md-2">
        <div class="col col-md-8">
          <h1 class="display-4" style="font-style: italic;">
            {% include 'logo/module.html' %}
            {% trans 'Modules catalog' %}
          </h1>
          <hr>
          <p class="lead">
            {% blocktrans %}
              For the students whom wants to build their own path piece by piece, we propose a collection of modules.
            {% endblocktrans %}
          </p>
        </div>

        <div class="col col-md-4">
          <img src="{% static 'draws/bookshelves.svg' %}" alt="Modules catalog" class="img-fluid rounded">
        </div>
      </div>
    </div>
  </section>


  {# Information bubble #}

  
  {% if not request.user|is_back_office_user %}
    <section class="container">
      <div class="row row-cols-1 row-cols-md-2 bg-info rounded text-white pt-2">
        <div class="col-md-1 text-center text-md-right">
          <h1>{% include 'logo/info.html' %}</h1>
        </div>
        <div class="col-md-11">
          <p class="text-justify">
            <span class="h5 font-weight-bold">
              {% blocktrans %}
              Know more about the prerequisites conditions.
              {% endblocktrans %}
            </span>
            <br>
            {% blocktrans %}
            Some modules has prerequisites modules, which means other modules which must be completed and succeeded by the student before being able to follow the desired module.
            {% endblocktrans %}
            <br><br>
            {% blocktrans %}
            If you already passed one of these modules here or in another educational institution, you can request for an examption. If the insitutution approves your examption, the module will be considered as succeeded and won't be charged.
            {% endblocktrans %}
          </p>
        </div>
      </div>
    </section>

    <br>
  {% endif %}


  {# Statistical informations #}

  <section class="container">
    <div class="row text-muted">
      <div class="col-sm">
        {% blocktrans count nb_modules=modules.count %}
          There is actually only one module available.
        {% plural %}
          They are actually {{ nb_modules }} modules available.
        {% endblocktrans %}
      </div>
    </div>
  </section>


  {# Create new module button #}

  <div class="row">
    {% if request.user|is_manager_or_administrator %}
      <div class="col">
        <a href="{% url 'module_createview' %}" class="btn btn-block btn-warning">
          Create a new module {% include 'logo/new.html' %}
        </a>
      </div>
    {% endif %}
    <div class="col">
      <a href="{% url 'modulelevel_listview' %}" class="btn btn-block btn-dark">
        Consult the modules by level {% include 'logo/module_alt.html' %}
      </a>
    </div>
  </div>


  {# Modules cards #}

  <section class="container">
    <div class="row row-cols-1">
      {% for module in modules %}
      <div class="card my-3">
        <div class="card-header text-center pt-3">
          <div class="row">
            <div class="col d-none d-md-block">
              {% trans 'Number of eligible teacher: ' %}{{ module.eligible_teachers.count }}
            </div>
            <div class="col h5">
              {% trans 'Regitration fee: ' %}<strong>â‚¬ {{ module.price }}</strong>
            </div>
            <div class="col d-none d-md-block">
              {% trans 'Number of courses available' %}: {{ module.courses.count }}
            </div>
          </div>
        </div>

        <div class="card-body">
          <div class="row">
            <div class="col-md-4 text-center">
              <img src="{{ module.picture.url }}" class="img-fluid" alt="{{ module.title }} module picture" style="max-height: 200px;">
            </div>
              <div class="col-md-8">
                <div class="card-body">
                  <h5 class="card-title">{% include 'logo/module.html' %} {{ module.title }}</h5>
                  <p class="card-text"><small class="text-muted">{{ module.reference }} | {% trans 'Difficulty level: ' %}{{ module.level.name }}</small></p>
                  <p class="card-text">{{ module.description|linebreaks|truncatechars:256 }}</p>
                  <div>
                    {% if request.user|is_student %}
                      {% if request.user|module_already_validated_by_user:module %}
                        <span class="text-success">
                          {% include 'logo/check_valid.html' %} {% trans 'Module already validated' %}
                        </span>

                      {% elif module.prerequisites.all.count > 0 and request.user|all_prerequisites_validated_by_user:module %}
                        <span class="text-warning">
                          {% include 'logo/check_ready.html' %} {% trans 'Prerequisites validated' %}
                        </span>

                      {% elif module.prerequisites.all.count > 0 %}
                        <span class="text-danger">
                          {% include 'logo/check_invalid.html' %} {% trans 'Prerequisites missing' %}
                        </span>
                      {% endif %}

                    {% elif module.prerequisites.all.count > 0 %}
                      <span class="text-info">{% include 'logo/check_info.html' %} 
                        {% blocktrans count nb_prerequisites=module.prerequisites.all.count %}
                          This module has only one prerequisite itself.
                        {% plural %}
                          This module has {{ nb_prerequisites }} perequisites itself.
                        {% endblocktrans %}
                      </span>

                    {% else %}
                      <span class="text-info">{% include 'logo/check_info.html' %} 
                        {% blocktrans  %}
                          This module has no prerequisites.
                        {% endblocktrans %}
                      </span>
                    {% endif %}
                  </div>
                </div>
              </div>
            </div>
          </div>

          <div class="card-footer text-center">
            <div class="row row-cols-1 row-cols-md-2 my-2 my-md-0">
              <div class="col mb-2 mb-md-0">
                <a href="{{ module.get_absolute_url }}" class="btn btn-block btn-outline-dark">{% trans 'See more' %} {% include 'logo/more.html' %}</a>
              </div>
              {% if request.user|is_manager_or_administrator %}
                <div class="col">
                  <div class="row">
                    <div class="col">
                      <a href="{% url 'module_updateview' pk=module.pk %}" class="btn btn-block btn-warning">{% trans 'Update' %} {% include 'logo/edit.html' %}</a>
                    </div>
                    <div class="col">
                      <a href="{% url 'module_deleteview' pk=module.pk %}" class="btn btn-block btn-danger">{% trans 'Delete' %} {% include 'logo/delete.html' %}</a>
                    </div>
                  </div>
                </div>

              {% elif request.user|is_teacher %}
                <div class="col">
                  <a href="#" class="btn btn-block btn-info">{% trans 'DEBUG: No functionality yet for Teachers' %} {% include 'logo/warning.html' %}</a>  <!-- TODO: add functionality -->
                </div>

              {% elif request.user|is_student %}
                <div class="col">
                  <a href="{% url 'module_payment' pk=module.pk %}" class="btn btn-block btn-dark">{% trans 'Subscribe to this module' %} {% include 'logo/puzzle.html' %}</a>  <!-- TODO: redirect to module_rr_createview -->
                </div>

              {% elif request.user|is_guest %}
                <div class="col">
                  <a href="{% url 'pursue_registration' %}" class="btn btn-block btn-dark">{% trans 'Finish your registration as a student' %} {% include 'logo/register_alt.html' %}</a>
                </div>

              {% else %}
                <div class="col">
                  <div class="row">
                    <div class="col">
                      <a href="{% url 'register' %}" class="btn btn-block btn-dark">{% trans 'Sign up' %} {% include 'logo/register.html' %}</a>
                    </div>
                    <div class="col">
                      <a href="{% url 'login' %}" class="btn btn-block btn-outline-dark">{% trans 'Sign in' %} {% include 'logo/in-left.html' %}</a>
                    </div>
                  </div>
                </div>
              {% endif %}
            </div>
          </div>
        </div>
      {% endfor %}
    </div>
  </section>

{% endblock content %}
